!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).SplitType=e()}(this,function(){"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function e(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?r(Object(i),!0).forEach(function(e){n(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(l){i=!0,o=l}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}}(t,e)||a(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function c(t,e){return Object.getOwnPropertyNames(Object(t)).reduce(function(n,r){var i=Object.getOwnPropertyDescriptor(Object(t),r),o=Object.getOwnPropertyDescriptor(Object(e),r);return Object.defineProperty(n,r,o||i)},{})}function u(t){return"string"==typeof t}function f(t){return Array.isArray(t)}function p(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=c(e);return void 0!==n.types?t=n.types:void 0!==n.split&&(t=n.split),void 0!==t&&(n.types=(u(t)||f(t)?String(t):"").split(",").map(function(t){return String(t).trim()}).filter(function(t){return/((line)|(word)|(char))/i.test(t)})),(n.absolute||n.position)&&(n.absolute=n.absolute||/absolute/.test(e.position)),n}function h(t){var e=u(t)||f(t)?String(t):"";return{none:!e,lines:/line/i.test(e),words:/word/i.test(e),chars:/char/i.test(e)}}function d(t){return null!==t&&"object"==typeof t}function y(t){return d(t)&&/^(1|3|11)$/.test(t.nodeType)}function v(t){var e,n;return f(t)?t:null==t?[]:d(e=t)&&"number"==typeof(n=e.length)&&n>-1&&n%1==0?Array.prototype.slice.call(t):[t]}function g(t){var e=t;return u(t)&&(e=/^(#[a-z]\w+)$/.test(t.trim())?document.getElementById(t.trim().slice(1)):document.querySelectorAll(t)),v(e).reduce(function(t,e){return[].concat(s(t),s(v(e).filter(y)))},[])}!function(){function t(){for(var t=arguments.length,e=0;e<t;e++){var n=e<0||arguments.length<=e?void 0:arguments[e];1===n.nodeType||11===n.nodeType?this.appendChild(n):this.appendChild(document.createTextNode(String(n)))}}function e(){for(;this.lastChild;)this.removeChild(this.lastChild);arguments.length&&this.append.apply(this,arguments)}function n(){for(var t=this.parentNode,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.length;if(t)for(i||t.removeChild(this);i--;){var o=n[i];"object"!=typeof o?o=this.ownerDocument.createTextNode(o):o.parentNode&&o.parentNode.removeChild(o),i?t.insertBefore(this.previousSibling,o):t.replaceChild(o,this)}}"undefined"!=typeof Element&&(Element.prototype.append||(Element.prototype.append=t,DocumentFragment.prototype.append=t),Element.prototype.replaceChildren||(Element.prototype.replaceChildren=e,DocumentFragment.prototype.replaceChildren=e),Element.prototype.replaceWith||(Element.prototype.replaceWith=n,DocumentFragment.prototype.replaceWith=n))}();var $=Object.entries,m="_splittype",w={},b=0;function C(t,e,n){if(!d(t))return console.warn("[data.set] owner is not an object"),null;var r=t[m]||(t[m]=++b),o=w[r]||(w[r]={});return void 0===n?e&&Object.getPrototypeOf(e)===Object.prototype&&(w[r]=i(i({},o),e)):void 0!==e&&(o[e]=n),n}function _(t,e){var n=d(t)?t[m]:null,r=n&&w[n]||{};return void 0===e?r:r[e]}function S(t){var e=t&&t[m];e&&(delete t[e],delete w[e])}var E="\ud800-\udfff",x="\\u0300-\\u036f\\ufe20-\\ufe23",W="\\u20d0-\\u20f0",P="\\ufe0e\\ufe0f",k="[".concat(E,"]"),N="[".concat(x).concat(W,"]"),O="\ud83c[\udffb-\udfff]",T="(?:".concat(N,"|").concat(O,")"),D="[^".concat(E,"]"),j="(?:\ud83c[\udde6-\uddff]){2}",A="[\ud800-\udbff][\udc00-\udfff]",B="".concat(T,"?"),I="[".concat(P,"]?"),L=I+B+("(?:\\u200d(?:"+[D,j,A].join("|")+")"+I)+B+")*",H="(?:".concat(["".concat(D).concat(N,"?"),N,j,A,k].join("|"),"\n)"),R=RegExp("".concat(O,"(?=").concat(O,")|").concat(H).concat(L),"g"),M=RegExp("[".concat(["\\u200d",E,x,W,P].join(""),"]"));function z(t){return M.test(t)}function F(t,e){var n=document.createElement(t);return e&&Object.keys(e).forEach(function(t){var r=e[t],i=u(r)?r.trim():r;null!==i&&""!==i&&("children"===t?n.append.apply(n,s(v(i))):n.setAttribute(t,i))}),n}var V={splitClass:"",lineClass:"line",wordClass:"word",charClass:"char",types:["lines","words","chars"],absolute:!1,tagName:"div"},q=c(V,{});return function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,t),this.isSplit=!1,this.settings=c(q,p(n)),this.elements=g(e),this.split()}return e(t,null,[{key:"clearData",value:function(){Object.keys(w).forEach(function(t){delete w[t]})}},{key:"setDefaults",value:function(t){return q=c(q,p(t)),V}},{key:"revert",value:function(t){g(t).forEach(function(t){var e=_(t),n=e.isSplit,r=e.html,i=e.cssWidth,o=e.cssHeight;n&&(t.innerHTML=r,t.style.width=i||"",t.style.height=o||"",S(t))})}},{key:"create",value:function(e,n){return new t(e,n)}},{key:"data",get:function(){return w}},{key:"defaults",get:function(){return q},set:function(t){q=c(q,p(t))}},]),e(t,[{key:"split",value:function(t){var e=this;this.revert(),this.elements.forEach(function(t){C(t,"html",t.innerHTML)}),this.lines=[],this.words=[],this.chars=[];var n=[window.pageXOffset,window.pageYOffset];void 0!==t&&(this.settings=c(this.settings,p(t)));var r=h(this.settings.types);r.none||(this.elements.forEach(function(t){C(t,"isRoot",!0);var n=function t(e,n){var r,i,o,a,l,f,p,d,y=e.nodeType,g={words:[],chars:[]};if(!/(1|3|11)/.test(y))return g;if(3===y&&/\S/.test(e.nodeValue))return r=e,i=n,a=h((i=c(V,i)).types),l=i.tagName,f=r.nodeValue,p=document.createDocumentFragment(),d=[],/^\s/.test(f)&&p.append(" "),o=(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:" ";return(t?String(t):"").trim().replace(/\s+/g," ").split(e)})(f).reduce(function(t,e,n,r){var o,c;return a.chars&&(c=(function(t){var e,n,r,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(t=null==(e=t)?"":String(e))&&u(t)&&!o&&z(t)?z(n=t)?(r=n).match(R)||[]:(i=n).split(""):t.split(o)})(e).map(function(t){var e=F(l,{class:"".concat(i.splitClass," ").concat(i.charClass),style:"display: inline;",children:t});return C(e,"isChar",!0),d=[].concat(s(d),[e]),e})),a.words||a.lines?(C(o=F(l,{class:"".concat(i.wordClass," ").concat(i.splitClass),style:"display: inline; ".concat(a.words&&i.absolute?"position: relative;":""),children:a.chars?c:e}),{isWord:!0,isWordStart:!0,isWordEnd:!0}),p.appendChild(o)):c.forEach(function(t){p.appendChild(t)}),n<r.length-1&&p.append(" "),a.words?t.concat(o):t},[]),/\s$/.test(f)&&p.append(" "),r.replaceWith(p),{words:o,chars:d};var $=v(e.childNodes);if($.length&&(C(e,"isSplit",!0),!_(e).isRoot)){e.style.display="inline",e.style.position="relative";var m=e.nextSibling,w=e.previousSibling,b=e.textContent||"",S=m?m.textContent:" ",E=w?w.textContent:" ";C(e,{isWordEnd:/\s$/.test(b)||/^\s/.test(S),isWordStart:/^\s/.test(b)||/\s$/.test(E)})}return $.reduce(function(e,r){var i=t(r,n),o=i.words,a=i.chars;return{words:[].concat(s(e.words),s(o)),chars:[].concat(s(e.chars),s(a))}},g)}(t,e.settings),r=n.words,i=n.chars;e.words=[].concat(s(e.words),s(r)),e.chars=[].concat(s(e.chars),s(i))}),this.elements.forEach(function(t){if(r.lines||e.settings.absolute){var i,a,l,c,u,f,p,d,y,g,$,m,w,b,E,x,W,P,k,N=(i=t,a=e.settings,l=n,p=h(a.types),d=a.tagName,y=i.getElementsByTagName("*"),g=[],$=[],m=null,w=[],b=i.parentElement,E=i.nextElementSibling,x=document.createDocumentFragment(),P=(W=window.getComputedStyle(i)).textAlign,k=.2*parseFloat(W.fontSize),a.absolute&&(f={left:i.offsetLeft,top:i.offsetTop,width:i.offsetWidth},u=i.offsetWidth,c=i.offsetHeight,C(i,{cssWidth:i.style.width,cssHeight:i.style.height})),v(y).forEach(function(t){var e=t.parentElement===i,n=function(t,e,n,r){if(!n.absolute)return{top:e?t.offsetTop:null};var i=t.offsetParent,s=o(r,2),a=s[0],l=s[1],c=0,u=0;if(i&&i!==document.body){var f=i.getBoundingClientRect();c=f.x+a,u=f.y+l}var p=t.getBoundingClientRect(),h=p.width,d=p.height,y=p.x;return{width:h,height:d,top:p.y+l-u,left:y+a-c}}(t,e,a,l),r=n.width,s=n.height,c=n.top,u=n.left;/^br$/i.test(t.nodeName)||(p.lines&&e&&((null===m||c-m>=k)&&(m=c,g.push($=[])),$.push(t)),a.absolute&&C(t,{top:c,left:u,width:r,height:s}))}),b&&b.removeChild(i),p.lines&&(w=g.map(function(t){var e=F(d,{class:"".concat(a.splitClass," ").concat(a.lineClass),style:"display: block; text-align: ".concat(P,"; width: 100%;")});C(e,"isLine",!0);var n={height:0,top:1e4};return x.appendChild(e),t.forEach(function(t,r,i){var o=_(t),s=o.isWordEnd,a=o.top,l=o.height,c=i[r+1];n.height=Math.max(n.height,l),n.top=Math.min(n.top,a),e.appendChild(t),s&&_(c).isWordStart&&e.append(" ")}),a.absolute&&C(e,{height:n.height,top:n.top}),e}),p.words||function t(e){_(e).isWord?(S(e),e.replaceWith.apply(e,s(e.childNodes))):v(e.children).forEach(function(e){return t(e)})}(x),i.replaceChildren(x)),a.absolute&&(i.style.width="".concat(i.style.width||u,"px"),i.style.height="".concat(c,"px"),v(y).forEach(function(t){var e=_(t),n=e.isLine,r=e.top,i=e.left,o=e.width,s=e.height,a=_(t.parentElement),l=!n&&a.isLine;t.style.top="".concat(l?r-a.top:r,"px"),t.style.left="".concat(n?f.left:i-(l?f.left:0),"px"),t.style.height="".concat(s,"px"),t.style.width="".concat(n?f.width:o,"px"),t.style.position="absolute"})),b&&(E?b.insertBefore(i,E):b.appendChild(i)),w);e.lines=[].concat(s(e.lines),s(N))}}),this.isSplit=!0,window.scrollTo(n[0],n[1]),$(w).forEach(function(t){var e=o(t,2),n=e[0],r=e[1],i=r.isRoot,s=r.isSplit;i&&s||(w[n]=null,delete w[n])}))}},{key:"revert",value:function(){this.isSplit&&(this.lines=null,this.words=null,this.chars=null,this.isSplit=!1),t.revert(this.elements)}},]),t}()});
